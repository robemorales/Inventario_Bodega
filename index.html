<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario IT - AES Chile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        body { background-color: #f4f7f6; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .header-aes { background-color: #00529b; color: white; padding: 20px; border-radius: 0 0 15px 15px; }
        .card { border: none; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .btn-primary { background-color: #00529b; border: none; }
        .btn-primary:hover { background-color: #003d73; }
    </style>
</head>
<body>

<div class="container mb-5">
    <div class="header-aes text-center mb-4 shadow">
        <h2>游닍 Control de Inventario IT</h2>
        <p class="mb-0">Gesti칩n de Activos - Zona Norte</p>
    </div>

    <div class="card p-4 mb-4">
        <h5 class="text-secondary mb-3">Registrar Nuevo Equipo</h5>
        <div class="row g-3">
            <div class="col-md-3">
                <label class="form-label fw-bold">Categor칤a</label>
                <select id="categoria" class="form-select">
                    <option>Laptop</option><option>Desktop</option><option>Rallybar</option>
                    <option>Kit Teclado/Mouse</option><option>Mochila</option><option>Docking</option>
                </select>
            </div>
            <div class="col-md-3"><label class="form-label fw-bold">Marca</label><input type="text" id="marca" class="form-control"></div>
            <div class="col-md-3"><label class="form-label fw-bold">Modelo</label><input type="text" id="modelo" class="form-control"></div>
            <div class="col-md-3"><label class="form-label fw-bold">N칰mero de Serie</label><input type="text" id="serie" class="form-control"></div>
            <div class="col-md-3">
                <label class="form-label fw-bold">Estado</label>
                <select id="estado" class="form-select">
                    <option>Disponible</option><option>En Uso</option><option>Da침ado</option><option>En Reparaci칩n</option>
                </select>
            </div>
            <div class="col-md-3"><label class="form-label fw-bold">Ubicaci칩n</label><input type="text" id="ubicacion" class="form-control" placeholder="Ej: Angamos"></div>
            <div class="col-md-3"><label class="form-label fw-bold">Usuario/Asignado</label><input type="text" id="usuario" class="form-control"></div>
            <div class="col-md-3"><label class="form-label fw-bold">Fecha de Ingreso</label><input type="date" id="fecha" class="form-control"></div>
            <div class="col-md-9"><label class="form-label fw-bold">Comentarios</label><input type="text" id="comentarios" class="form-control"></div>
            <div class="col-md-3 d-flex align-items-end">
                <button onclick="agregarItem()" class="btn btn-primary w-100 fw-bold">A침adir al Inventario</button>
            </div>
        </div>
    </div>

    <div class="card p-4 shadow-sm">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="m-0 text-secondary">Equipos en Bodega</h5>
            <div>
                <button onclick="descargarExcel()" class="btn btn-sm btn-success">游닌 Exportar Reporte Excel</button>
                <input type="file" id="importar" class="d-none" onchange="importarExcel(event)">
                <button onclick="document.getElementById('importar').click()" class="btn btn-sm btn-outline-secondary">游닋 Cargar Base de Datos</button>
            </div>
        </div>
        
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>Categor칤a</th><th>Marca</th><th>Modelo</th><th>S/N</th><th>Estado</th><th>Ubicaci칩n</th><th>Usuario</th><th>Acci칩n</th>
                    </tr>
                </thead>
                <tbody id="tablaCuerpo" class="small"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // Recuperar datos guardados o iniciar vac칤o
    let inventario = JSON.parse(localStorage.getItem('it_inventario_final')) || [];

    function renderTabla() {
        const cuerpo = document.getElementById('tablaCuerpo');
        cuerpo.innerHTML = '';
        inventario.forEach((item, index) => {
            cuerpo.innerHTML += `
                <tr>
                    <td><strong>${item.categoria}</strong></td>
                    <td>${item.marca}</td>
                    <td>${item.modelo}</td>
                    <td><code>${item.serie}</code></td>
                    <td><span class="badge ${getBadgeColor(item.estado)}">${item.estado}</span></td>
                    <td>${item.ubicacion}</td>
                    <td>${item.usuario}</td>
                    <td><button onclick="eliminar(${index})" class="btn btn-sm btn-link text-danger">Borrar</button></td>
                </tr>`;
        });
        // Guardar en la memoria local del navegador
        localStorage.setItem('it_inventario_final', JSON.stringify(inventario));
    }

    function getBadgeColor(estado) {
        if(estado === 'Disponible') return 'bg-success';
        if(estado === 'En Uso') return 'bg-primary';
        if(estado === 'Da침ado') return 'bg-danger';
        return 'bg-warning text-dark';
    }

    function agregarItem() {
        const IDs = ['categoria', 'marca', 'modelo', 'serie', 'estado', 'ubicacion', 'usuario', 'fecha', 'comentarios'];
        const data = {};
        IDs.forEach(id => { data[id] = document.getElementById(id).value; });

        if(data.serie && data.modelo) {
            inventario.push(data);
            renderTabla();
            // Limpiar campos de texto
            ['marca','modelo','serie','ubicacion','usuario','fecha','comentarios'].forEach(id => document.getElementById(id).value = "");
        } else {
            alert("Por favor completa al menos el Modelo y N칰mero de Serie");
        }
    }

    function eliminar(index) {
        if(confirm("쮼st치s seguro de eliminar este equipo?")) {
            inventario.splice(index, 1);
            renderTabla();
        }
    }

    function descargarExcel() {
        const ws = XLSX.utils.json_to_sheet(inventario);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Inventario_IT");
        XLSX.writeFile(wb, "Reporte_Inventario_IT_AES.xlsx");
    }

    function importarExcel(event) {
        const reader = new FileReader();
        reader.onload = (e) => {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            inventario = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
            renderTabla();
        };
        reader.readAsArrayBuffer(event.target.files[0]);
    }

    // Carga inicial
    renderTabla();
</script>
</body>
</html>