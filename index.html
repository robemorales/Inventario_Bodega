<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario IT - AES Chile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        body { background-color: #f8f9fa; font-family: sans-serif; }
        .header-aes { background-color: #00529b; color: white; padding: 20px; margin-bottom: 20px; border-radius: 0 0 15px 15px; }
        .card { border: none; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .form-label { font-weight: bold; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="container mb-5">
    <div class="header-aes shadow-sm text-center">
        <h2>游닍 Control de Inventario IT</h2>
        <p class="mb-0">Gesti칩n de Activos - Zona Norte</p>
    </div>

    <div class="card p-4 mb-4">
        <h5 class="text-secondary mb-3">Nuevo Registro</h5>
        <div class="row g-3">
            <div class="col-md-3">
                <label class="form-label">Categor칤a</label>
                <select id="categoria" class="form-select">
                    <option>Laptop</option>
                    <option>Desktop</option>
                    <option>Rallybar</option>
                    <option>Kit Teclado/Mouse</option>
                    <option>Mochila</option>
                    <option>Docking</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Marca</label>
                <input type="text" id="marca" class="form-control" placeholder="Ej: Dell, Logitech">
            </div>
            <div class="col-md-3">
                <label class="form-label">Modelo</label>
                <input type="text" id="modelo" class="form-control" placeholder="Ej: Latitude 5440">
            </div>
            <div class="col-md-3">
                <label class="form-label">N칰mero de Serie</label>
                <input type="text" id="serie" class="form-control" placeholder="S/N 칔nico">
            </div>
            <div class="col-md-3">
                <label class="form-label">Estado</label>
                <select id="estado" class="form-select">
                    <option>Disponible</option>
                    <option>En Uso</option>
                    <option>Da침ado</option>
                    <option>En Reparaci칩n</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Ubicaci칩n</label>
                <input type="text" id="ubicacion" class="form-control" placeholder="Ej: Bodega Central">
            </div>
            <div class="col-md-3">
                <label class="form-label">Usuario/Asignado</label>
                <input type="text" id="usuario" class="form-control" placeholder="Nombre del colaborador">
            </div>
            <div class="col-md-3">
                <label class="form-label">Fecha de Ingreso</label>
                <input type="date" id="fecha" class="form-control">
            </div>
            <div class="col-md-3">
                <label class="form-label">Imagen Equipo</label>
                <div class="input-group">
                    <input type="file" id="fotoArchivo" accept="image/*" capture="environment" class="d-none" onchange="procesarFoto(event)">
                    <button onclick="document.getElementById('fotoArchivo').click()" class="btn btn-outline-info w-100">
                        游닝 Capturar desde C치mara
                    </button>
                </div>
                <div id="previewContainer" class="mt-2 d-none">
                    <img id="imgPreview" src="" alt="Vista previa" style="max-height: 100px; border-radius: 8px;">
                </div>
            </div>
            <div class="col-md-3 d-flex align-items-end">
                <button onclick="agregarItem()" class="btn btn-primary w-100">Guardar Equipo</button>
            </div>
        </div>
    </div>

    <div class="card p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="text-secondary m-0">Equipos en Inventario</h5>
            <div>
                <button onclick="descargarExcel()" class="btn btn-sm btn-outline-success">游닌 Exportar Excel</button>
                <input type="file" id="importar" class="d-none" onchange="importarExcel(event)">
                <button onclick="document.getElementById('importar').click()" class="btn btn-sm btn-outline-secondary">游닋 Cargar BD</button>
            </div>
        </div>
        
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light text-nowrap">
                    <tr>
                        <th>Categor칤a</th>
                        <th>Marca</th>
                        <th>Modelo</th>
                        <th>S/N</th>
                        <th>Estado</th>
                        <th>Ubicaci칩n</th>
                        <th>Usuario</th>
                        <th>Fecha</th>
                        <th>Acci칩n</th>
                    </tr>
                </thead>
                <tbody id="tablaCuerpo" class="small"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    let inventario = JSON.parse(localStorage.getItem('it_inventario_aes')) || [];

    function renderTabla() {
        const cuerpo = document.getElementById('tablaCuerpo');
        cuerpo.innerHTML = '';
        inventario.forEach((item, index) => {
            cuerpo.innerHTML += `
                <tr>
                    <td><strong>${item.categoria}</strong></td>
                    <td>${item.marca}</td>
                    <td>${item.modelo}</td>
                    <td><code>${item.serie}</code></td>
                    <td><span class="badge ${getBadgeColor(item.estado)}">${item.estado}</span></td>
                    <td>${item.ubicacion}</td>
                    <td>${item.usuario}</td>
                    <td>${item.fecha}</td>
                    <td><button onclick="eliminar(${index})" class="btn btn-sm btn-link text-danger p-0">Borrar</button></td>
                </tr>`;
        });
        localStorage.setItem('it_inventario_aes', JSON.stringify(inventario));
    }

    function getBadgeColor(estado) {
        if(estado === 'Disponible') return 'bg-success';
        if(estado === 'En Uso') return 'bg-primary';
        if(estado === 'Da침ado') return 'bg-danger';
        return 'bg-warning text-dark';
    }

    function agregarItem() {
        const data = {
            categoria: document.getElementById('categoria').value,
            marca: document.getElementById('marca').value,
            modelo: document.getElementById('modelo').value,
            serie: document.getElementById('serie').value,
            estado: document.getElementById('estado').value,
            ubicacion: document.getElementById('ubicacion').value,
            usuario: document.getElementById('usuario').value,
            fecha: document.getElementById('fecha').value,
            comentarios: document.getElementById('comentarios').value
        };

        if(data.serie && data.modelo) {
            inventario.push(data);
            renderTabla();
            limpiarCampos();
        } else {
            alert("S/N y Modelo son obligatorios");
        }
    }

    function limpiarCampos() {
        ['marca','modelo','serie','ubicacion','usuario','fecha','comentarios'].forEach(id => {
            document.getElementById(id).value = '';
        });
    }

    function eliminar(index) {
        if(confirm("쮼liminar este registro?")) {
            inventario.splice(index, 1);
            renderTabla();
        }
    }

    function descargarExcel() {
        const ws = XLSX.utils.json_to_sheet(inventario);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Inventario_IT");
        XLSX.writeFile(wb, "Inventario_IT_ZonaNorte.xlsx");
    }

    function importarExcel(event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            const jsonData = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
            inventario = jsonData;
            renderTabla();
        };
        reader.readAsArrayBuffer(file);
    }

    renderTabla();
</script>
</body>
</html>